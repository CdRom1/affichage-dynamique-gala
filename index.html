<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<style>
body {
color:white;
background-color:black;
background-image:url(fondGalaHorizontal.png);
}
</style>
</head>

  <body>

    <h1>
      Coucou
    </h1>

<table style="width:100%">
  <tr class="titres_scenes">
    <td>Scène 1</td>
    <td>Animations</td>
  </tr>
  <tr class="dans_x_minutes">
    <td id="fsc_ev_prochain_temps_restant">Dans X minutes</td>
    <td rowspan="2" id="anim_ev_prochain">Prochaines animations</td>
  </tr>
  <tr class="nom_prochain_evenement">
    <td id="fsc_ev_prochain_nom">Nom du prochain év sc1</td>
    <!-- Cette cellule a été fusionnée avec anim_ev_prochain -->
  </tr>
  <tr class="etat_en_cours">
    <td id="fsc_ev_en_cours_etat">En cours</td>
    <td id="anim_ev_en_cours_etat">Rien</td>
  </tr>
  <tr class="nom_evenement_en_cours">
    <td id="fsc_ev_en_cours_nom">Nom év en cours sc1</td>
    <td id="anim_ev_en_cours_nom">Nom év en cours anim</td>
  </tr>
</table>



<script>

var fsc = [
{ nom: "premier concert",
  debut: new Date(2018, 11, 12, 17, 10),
  fin: new Date(2018, 11, 12, 17, 20),
},
{ nom: "deuxième concert",
  debut: new Date(2018, 11, 12, 17, 20),
  fin: new Date(2018, 11, 12, 17, 30),
},
]

var anim = [
{ nom: "anim 1a",
  debut: new Date(2018, 11, 12, 17, 00),
  fin: new Date(2018, 11, 12, 17, 10),
},
{ nom: "anim 1b",
  debut: new Date(2018, 11, 12, 17, 00),
  fin: new Date(2018, 11, 12, 17, 10),
},
{ nom: "anim 2",
  debut: new Date(2018, 11, 12, 17, 10),
  fin: new Date(2018, 11, 12, 17, 20),
},
]

var deuxChiffres = new Intl.NumberFormat("fr", {minimumIntegerDigits:2});

alerte();

function alerte() {
var d = new Date();
var d15minutes = new Date(d.getTime() + (15 * 60 * 1000));



var fscEnCours, fscProchain;
var animsEnCours = [];
var animsProchaines = [];


//parsage FSC
fsc.forEach( (ev) => {
  if(d > ev.debut && ev.fin > d ) {fscEnCours = ev;}
  if(d < ev.debut && ev.debut < d15minutes) {fscProchain = ev;}
})

//parsage Animations
anim.forEach( (ev) => {
  if(d > ev.debut && ev.fin > d ) { animsEnCours.push(ev); }
  if(d < ev.debut && ev.debut < d15minutes) { animsProchaines.push(ev);}
})

//Affichage FSC
affichageScene(fscEnCours,fscProchain,document.getElementById("fsc_ev_en_cours_nom"),document.getElementById("fsc_ev_en_cours_etat"),document.getElementById("fsc_ev_prochain_nom"),document.getElementById("fsc_ev_prochain_temps_restant"))
affichageAnimation(animsEnCours, animsProchaines, document.getElementById("anim_ev_en_cours_nom"),document.getElementById("anim_ev_en_cours_etat"),document.getElementById("anim_ev_prochain"))

  setTimeout(alerte, 1000);
}

//prend en argument les deux objets d'événement, et les tags HTML dans lesquels il faut output le texte
function affichageScene(encours, prochain, encours_nom, encours_etat, prochain_nom, prochain_etat) {
var d = new Date();
  //TODO: remplacer le 'rien' par rien, c'est pas très classe pour le gala
  encours_nom.innerHTML = encours ? encours.nom : "Rien";
  encours_etat.innerHTML = encours ? "En cours" : "Rien";
  prochain_nom.innerHTML = prochain ? prochain.nom : "Rien";
  let delaySeconds = prochain ? Math.floor((prochain.debut.getTime() - d.getTime())/1000) : 0;
  let minutes = Math.floor(delaySeconds / 60);
  let secondes = Math.floor(delaySeconds % 60);
  prochain_etat.innerHTML = prochain ? "Dans " + deuxChiffres.format(minutes) + " minutes et " + deuxChiffres.format(secondes) + " secondes" : "Rien";
}

//prend en argument deux array contenant des objets d'événement, et les tags HTML dans lesquels il faut output le texte
function affichageAnimation(encours, prochain, encours_nom, encours_etat, prochain_cellule) {
var d = new Date();
  //TODO: remplacer le 'rien' par rien, c'est pas très classe pour le gala
  if(encours.length == 0) {
  encours_nom.innerHTML = "Rien";
  encours_etat.innerHTML = "Rien";
}
else {
  encours_etat.innerHTML = "En cours :";
  let output = "<ul>";
  encours.forEach( (ev) => {
    output += '<li>' + ev.nom +'</li>';
  });
  output += "</ul>";
  encours_nom.innerHTML = output;
}

if(prochain.length == 0) {
  prochain_cellule.innerHTML = "Rien";
}
else {
  let output = "<ul>";
 prochain.forEach( (ev) => {
   let delaySeconds = Math.floor((ev.debut.getTime() - d.getTime())/1000);
   let minutes = Math.floor(delaySeconds / 60);
   let secondes = Math.floor(delaySeconds % 60);
   output += "<li>" + ev.nom + "<br/><span class='temps_restant'>dans " + deuxChiffres.format(minutes) + " minutes et " + deuxChiffres.format(secondes) + " secondes</span></li>"
 });
 output += "</ul>";
prochain_cellule.innerHTML = output;
}

}

</script>
</body>
</html>
